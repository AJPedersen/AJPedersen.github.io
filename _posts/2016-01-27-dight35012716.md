---
layout: post
title: DIGHT350
permalink: dight350-012716
---

###Joins

Bringing info in from multiple tables, helpful with normalized database structure.


1. `INNER JOIN`
2. `LEFT JOIN`
3. `RIGHT JOIN`
4. `OUTER JOIN` (`UNION`)


####New SQL

```
ADD CONSTRAINT
FOREIGN KEY
REFERENCES
ON UPDATE
[LEFT | RIGHT] JOIN
ON
UNION
```

####Queries

```
CREATE TABLE alchemy_formulas
(
    id SMALLINT(5) UNSIGNED NOT NULL AUTO_INCREMENT,
    name VARCHAR(30) NOT NULL,
    effect VARCHAR(30) NOT NULL,
    element_id SMALLINT(5) UNSIGNED DEFAULT NULL,
    PRIMARY KEY (id)
)
ENGINE InnoDB
```

`SMALLINT` = small integer, can't go as high as `INT`

`DEFAULT NULL` = No element id provided, default value becomes 'NULL'.

`PRIMARY KEY (id)` = Same as putting `PRIMARY KEY` at end of first `id`. This is a personal preference. If your first line is long then this is sometimes easier to read.

Field level = Applies to the field, not entire table.

Table level = Applies to entire table, not field.

`ENGINE InnoDB` = Declared so we can create relationships and normalize tables.

___

```
CREATE TABLE formula_elements
(
    id SMALLINT(5) UNSIGNED NOT NULL AUTO_INCREMENT,
    element VARCHAR(50) NOT NULL,
    PRIMARY KEY (id)
)
ENGINE InnoDB
```


Has to be same type of `id` between both tables in order to have a relationship btwn the two.


All of the tables that you want to have a relationship with eachother, oooOOOooo, have to exist.


```
ALTER TABLE alchemy_formulas
ADD CONSTRAINT fk_type
FOREIGN KEY (element_id) REFERENCES formula_elements (id)
ON UPDATE CASCADE
```


`CONSTRAINT` has to be _unique_, good convention is to `fk_`, where 'fk' stands for `FOREIGN KEY`.

`FOREIGN KEY (element_id) REFERENCES formula_elements (id)` = Connect `element_id` table with `id` field from the `formula_elements` table.


####Inner join

```
SELECT alchemy_formulas.name,
       alchemy_formulas.effect,
       formula_elements.element
FROM
    alchemy_formulas
JOIN formula_elements
    ON alchemy_formulas.element_id = formula_elements.id
```

Selecting `name`, `effect`, `element` from `alchemy_formulas` and `formula_elements` tables. 


####Left join

```
SELECT alchemy_formulas.name,
       alchemy_formulas.effect,
       formula_elements.element
FROM
    alchemy_formulas
LEFT JOIN formula_elements
    ON alchemy_formulas.element_id = formula_elements.id
```

Pulls everything from the left table/1st table into the database.


####Right join

```
SELECT alchemy_formulas.name,
       alchemy_formulas.effect,
       formula_elements.element
FROM
    alchemy_formulas
RIGHT JOIN formula_elements
    ON alchemy_formulas.element_id = formula_elements.id
```

Pulls everything from right table/2nd table into the database.

`NULL` shows up here as a way to tell us that there was nothing there to return.

####Outer join

```
SELECT alchemy_formulas.name,
       alchemy_formulas.effect,
       formula_elements.element
FROM
    alchemy_formulas
LEFT JOIN formula_elements
    ON alchemy_formulas.element_id = formula_elements.id

UNION

SELECT alchemy_formulas.name,
       alchemy_formulas.effect,
       formula_elements.element
FROM
    alchemy_formulas
RIGHT JOIN formula_elements
    ON alchemy_formulas.element_id = formula_elements.id
```

Gets everything, all the things. In MySQL there is not `OUTER JOIN`, so you run a `LEFT JOIN` and `RIGHT JOIN` and bring them together with `UNION`.


Normalize, split them up, use `JOINS` to bring stuff back in - query stuff from multiple tables.


```
SELECT alchemy_formulas.name,
       alchemy_formulas.effect,
       formula_elements.element
       GROUP_CONCAT(alchemy_ingredients.name SEPARATOR ',') AS ingredients
FROM
    alchemy_formulas
LEFT JOIN formula_elements
    ON alchemy_formulas.element_id = formula_elements.id

UNION

SELECT alchemy_formulas.name,
       alchemy_formulas.effect,
       formula_elements.element
FROM
    alchemy_formulas
RIGHT JOIN formula_elements
    ON alchemy_formulas.element_id = formula_elements.id
GROUP BY
ORDER BY
```



`GROUP_CONCAT` = Allows multiple results to be combined into a list (concat), return them, seeperate them with comma. 

`SEPARATOR` = Returns results separated with whatever you provide.

`AS` = Renames your result to whatever you provide (temporary).

`GROUP BY` = Groups results by particular item/field.